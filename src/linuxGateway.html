<!doctype html>
<html lang="en">

    <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="Bohao Chu, and Bootstrap contributors">
    <title>Linux Gateway | Bohao Chu</title>
    <link rel="stylesheet" href="assets/css/bootstrap.min.css">

    <!-- Custom style sheet -->
    <link type="text/css" rel="stylesheet" href="assets/css/style.css"/>

    <!-- Google font -->
    <link href="https://fonts.googleapis.com/css?family=Nunito+Sans:700%7CNunito:300,600" rel="stylesheet">

    <!-- Title Icon -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.9.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
	
	<!-- Highlight JS -->
	<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
	<link rel="stylesheet" href="assets/highlight/styles/default.min.css">
	<script src="assets/highlight/highlight.min.js"></script>
	<script src="assets/js/bootstrap.bundle.min.js"></script>
	<script>
		hljs.highlightAll();
		addEventListener("DOMContentLoaded", function() {
			$(".header").load("components/header.html",function(){});
			$(".footer").load("components/footer.html",function(){});
		});
	</script>
	
    </head>


    <body>
		
        <header class="fixed-top header"></header>
		<main>
			<div class="section px-0">
				<div id="post-header" class="page-header pt-5" style="background-image: url('assets/img/lora/bg.png'); background-position-y: 75%; background-position-x: 85%; background-size: auto 50%">
					<div class="container">
						<div class="row">
							<div class="col-md-10 col-sm-11 post-meta">
								<a class="post-category cat-2" href="#">Machine Learning</a>
								<span class="post-date">Oct 3, 2022 </span>
								<br><br>
								<h1>Linux Gateway With LoRa and 4G</h1>
								<h3 class="text-light pt-3">
									Embedded Linux Gateway for LoRaWAN Networking and Data Transfer over 4G.
								</h3>
								<p>
									<span class="text-light">
										Bohao Chu, Yuting Jia, Chao Wang, and Yangjie Cao
									</span>
								</p>
								<button type="button" class="btn btn-dark btn-lg btn-circle me-3">
                                    <span class="fa fa-file-pdf-o"></span>
                                </button>
								<button type="button" class="btn btn-dark btn-lg btn-circle">
                                    <span class="fa fa-graduation-cap"></span>
                                </button>
							</div>
						</div>
					</div>
				</div>
			</div>

			<div class="section px-0">
				<!-- container -->
				<div class="container">
					<!-- row -->
					<div class="row">
						<!-- POST MAIN -->
						<div class="col-md-8 pe-md-5">

							<h3>INTRODUCTION</h3>


							<figure class="figure-img text-center">
								<img class="img-responsive" src="assets/img/lora/arch.png" alt="" width="100%">
							</figure>
							<p class="px-3 text-center">
								<small><strong>Figure 1.</strong> Architecture of Our Embedded Linux Gateway.</small>
							</p>


							<div class="row">
								<h4>BACKGROUND</h4>
								<p>
									In many scenarios, we need to collect data within an area, such as temperature in a city, or fire alarms in a building. With the rapid popularization of the Internet of Things technology, more and more terminal devices support the data networking function. Therefore, we can quickly network in an area. However, in the face of various types of terminal devices with different standards, the data platform cannot be compatible with every type of device. The gateway can help us solve this problem. It acts as a bridge between the node and the data platform. It reloads the received node data and accesses it to the data platform in the format required by the data platform.
								</p>

								<h4>MOTIVATION & GOALS</h4>
								<p>
									Based on mature wireless communication technologies, multiple networking modes are available, such as Wi-Fi, Bluetooth, ZigBee, LoRa, and NB-IoT. In regional networking, we need to pay attention to parameters such as cost, maximum transmission distance, power consumption, and penetration rate. In comparison, LoRa excels in all of these areas. Therefore, in this work, we design a LoRa gateway that can cover a radius of no more than 15 km (ideal theoretical value) and reload node data to the data platform through the 4G cellular network in the format required by the data platform.
								</p>
								<div class="row">
									<table class="table table-striped table-dark fs-6 mx-2">
										<tr>
										  <th>Technology</th>
										  <th>Frequency Band</th>
										  <th>Max. Trans. Distance</th>
										  <th>Max. Trans. Rate</th>
										  <th>Network Topology</th>
										  <th>Safety</th>
										</tr>
										<tr>
										  <td>LoRaWAN</td>
										  <td>868MHz, 915MHz</td>
										  <td>15km</td>
										  <td>300bps to 5.5kpbs</td>
										  <td>Start or Mix</td>
										  <td>AES-128</td>
										</tr>
										<tr>
											<td>ZigBee</td>
											<td>2.4GHz</td>
											<td>100m</td>
											<td>250kbps</td>
											<td>Mesh</td>
											<td>AES-128</td>
										</tr>
										<tr>
											<td>WiFi</td>
											<td>2.4GHz, 5GHz</td>
											<td>100m</td>
											<td>10Mbps to 1Gbps</td>
											<td>P2P</td>
											<td>WPA2</td>
										</tr>
										<tr>
											<td>NB-IoT</td>
											<td>800MHz to 2.2GHz</td>
											<td>10km</td>
											<td>250kbps</td>
											<td>Start</td>
											<td>AES</td>
										</tr>
										
									</table>
								</div>
								

								<h3 class="mt-4">METHOD</h3>
								<p>
									This is my first experience with embedded Linux systems, so Linux system porting takes up most of the work. This chapter consists of two parts. The first part explains how we build an embedded Linux system, and the second part describes how we build a gateway application. Note that the following is based on the  NXP.iMX6ULL processor.
								</p>

								<h4>Embedded Linux Operating System</h4>
								<p>
									From the perspective of developers, Linux consists of three parts: Boot Loader, Linux Kernel, and Root File System. The Boot Loader and Linux Kernel are closely related to hardware.
								</p>

								<h4 href="" class="text-muted">1. U-Boot</h4>
								<figure>
									<img src="assets/img/lora/uboot-3.png" width="100%">
								</figure>
								<p class="px-3 text-center">
									<small><strong>Figure 2.</strong> Uboot Components.</small>
								</p>

								<p>
									The BootLoader we use is U-Boot, which is short for Universal Boot Loader. It is an open-source project that complies with the GPL and is maintained by Wolfgang Denk of the DENX software work center in Germany. It supports multiple processors, including ARM, x86, MIPS, and RISCV. U-Boot is essentially a bare-metal program, which is similar to a single-chip microcomputer program. U-Boot uses assembly language and C language to operate some registers to initialize some peripherals, such as serial ports, networks, and DDR, and then loads the kernel program from the flash memory to the DDR to start the kernel. At the same time, control of the CPU is handed over to the kernel program, and its life cycle ends. It's just a complex and huge bare-metal program.
								</p>
								
								<figure class="row m-0 p-0">
									<img src="assets/img/lora/uboot-1.png" class="col-md-6">
									<img src="assets/img/lora/uboot-2.png" class="col-md-6">
								</figure>
								<p class="px-3 text-center">
									<small><strong>Figure 3.</strong> NXP.iMX6ULL Memory Addresses and Corresponding Runs.</small>
								</p>
								
								<span>
									A. Why initialize these peripherals?
								</span>
								<p>
									During development, we need to change the image system frequently. However, we do not always need to burn the kernel to the flash memory for debugging. We can directly load the kernel program from the PC to the DDR through the network (TFTP protocol) and start the system.
								</p>
								<span>
									B. What are the U-Boot boot modes?
								</span>
								<p>
									The U-Boot supports three boot modes, which are determined by the BOOT_MODE register. The BOOT_MODE can be controlled by the I/O pin. In the internal boot mode, the BOOT_CFG register controls the flash memory and some parameters.
								</p>
								<span>
									C. How does the CPU start the U-Boot?
								</span>
								<p>
									U-Boot is not the first program to be started after the CPU is powered on. The NXP.iMX6ULL processor has a 96K ROM and 128K RAM. The ROM contains a program that cannot be modified after delivery. The program is located at 0x00000000. Therefore, it is the first program specified after power-up. It initializes the flash interface, USB interface, and DDR. SoC vendors may use different DDR peripherals. Therefore, the BOOT ROM program loads the DDR information from the flash memory, initializes the DDR, and loads the U-Boot from the flash memory to the DDR.
								</p>


								
								<h4 class="text-muted">2. Kernel</h4>
								<p>
									The Linux kernel is a free and open-source: 4  monolithic, modular, multitasking, Unix-like operating system kernel. It was originally authored in 1991 by Linus Torvalds for his i386-based PC, and it was soon adopted as the kernel for the GNU operating system, which was written to be a free (libre) replacement for Unix.
								</p>

								<p>
									We ported the current relatively new Linux kernel, version number 5.4.70.Our compilation environment is Ubuntu 22.04, and we configured the Linaro cross-compiler, which is version number 7.5.0.
								</p>
								<figure class="row">
									<img src="assets/img/lora/kernel-1.png" width="100%">
								</figure>
								<p class="px-3 text-center">
									<small><strong>Figure 4.</strong> Components and Roles of the Linux Kernel.</small>
								</p>

								<h4 class="text-muted">3. Root File System</h4>
								<p>
									Cite Article <a href="https://wiki.ubuntu.com/Base">Ubuntu Base</a>
								</p>
								<p>
									Ubuntu Base is a minimal rootfs for use in the creation of custom images for specific needs. Ubuntu Base strives to create a suitable minimal environment for use in Board Support Packages, constrained or integrated environments, as the basis for application demonstration images, or Linux containers such as LXC or Docker (For OCI/docker container images, see also the Ubuntu OCI project). It is available for the i386, amd64, armhf, arm64, powerpc and ppc64el architectures.
								</p>
								<p>
									Ubuntu Base delivers a functional user-space environment, with full support for installation of additional software from the Ubuntu repositories, through the use of the apt-get command.
								</p>
								
<p>
	1. Downlaod <a href="https://cdimage.ubuntu.com/ubuntu-base/releases/22.04/release/">Ubuntu-base-22.04</a>
</p>
<pre>
<code class='bash card bg-dark text-light'>
wget https://cdimage.ubuntu.com/ubuntu-base/releases/22.04/release/ubuntu-base-22.04-base-arm64.tar.gz
mkdir ubuntu_base_rootfs
sudo tar xzf ubuntu-base-22.04-base-arm64.tar.gz -C ./ubuntu_base_rootfs/
cd ubuntu_base_rootfs/
</code>
</pre>

<p>
	2. Install qeumu, a generic and open source machine emulator and virtualizer.
</p>
<pre>
<code class='bash card bg-dark text-light'>
sudo apt install qemu-user-static
sudo cp /usr/bin/qemu-arm-static ./usr/bin/
sudo cp /etc/resolv.conf ./etc/resolv.conf
</code>
</pre>

<p>
	3. Mount the Ubuntu-base filesystem on the host computer.
</p>
<pre>
<code class='bash card bg-dark text-light'>
sudo mount -t proc /proc ./proc
sudo mount -t sysfs /sysfs ./sys
sudo mount -o bind /dev ./dev
sudo mount -o bind /dev/pts ./dev/pts
sudo chroot ./
</code>
</pre>

<p>
	4. Installing frequently used software to the ubuntu-base filesystem.
</p>
<pre>
<code class='bash card bg-dark text-light'>
apt update
apt install sudo vim kmod net-tools ethtool ifupdown language-pack-en-base rsyslog iputils-ping
passwd root
echo "linux" > /etc/hostname
echo "127.0.0.1 localhost" >> /etc/hosts
echo "127.0.0.1 linux" >> /etc/hosts
ln -s /lib/systemd/system/getty@.service /etc/systemd/system/getty.target.wants/getty@ttymxc0.service
</code>
</pre>

<p>
	5. Unmount Ubuntu-base from the host computer.
</p>
<pre>
<code class='bash card bg-dark text-light'>
exit
sudo umount ./proc
sudo umount ./sys
sudo umount ./dev/pts
sudo umount ./dev
</code>
</pre>


<div class="row mt-3">
<h4>Gateway Applications</h4>
<p>
	The main role of our gateway is to be a centralizer for different protocols, including LoRa, 485 and others. It also integrates 4G module for internet communication.
</p>

<p>
	1. LoRaWAN Integrator Application
</p>
<pre>
<code class='bash card bg-dark text-light'>
git clone https://github.com/Lora-net/lora_gateway
make
# change pin number to 123
./reset_lgw.sh
</code>
</pre>

<pre>
<code class='bash card bg-dark text-light'>
git clone https://github.com/Lora-net/packet_forwarder.git
make
# change server ip to bohao.de
./lora_pkt_fwd/lora_pkt_fwd
</code>
</pre>
</div>


					

								<h3 class="mt-4">
									KEYWORDS
								</h3>
								<p class="text-dark">
									<strong>
										Edge Computing Sensor Kit, Information Fusion, Machine Learning, Real-time Activity Recognition, Digital Twin, Data Visualization.
									</strong>
								</p>

							</div>

						</div>

						<!-- POST ASIDE -->
						<div class="col-md-4">
							<div class="row mb-3">
								<h3>MATERIALS</h3>

								<h4>HARDWARE</h4>
								<figure class="figure-img text-center">
									<img class="img-responsive" src="assets/img/lora/title.jpg" alt="" width="100%">
								</figure>
								<p class="px-3 pt-3 text-center">
									<small ><strong>Figure 5.</strong> Linux Gateway Physical Drawing.</small>
								</p>

								<figure class="figure-img text-center">
									<img class="img-responsive" src="assets/img/lora/main.png" alt="" width="100%">
								</figure>
								<p class="px-3 pt-3 text-center">
									<small ><strong>Figure 6.</strong> Schematic diagram of IMX6ULL core connection.</small>
								</p>

								<figure class="figure-img text-center">
									<img class="img-responsive" src="assets/img/lora/lora.png" alt="" width="100%">
								</figure>
								<p class="px-3 pt-3 text-center">
									<small ><strong>Figure 7.</strong> Schematic diagram of lora module connection.</small>
								</p>

								<figure class="figure-img text-center">
									<img class="img-responsive" src="assets/img/lora/4G.png" alt="" width="100%">
								</figure>
								<p class="px-3 pt-3 text-center">
									<small ><strong>Figure 8.</strong> Schematic diagram of 4G module connection.</small>
								</p>

								

								<figure class="figure-img text-center">
									<img class="img-responsive" src="assets/img/lora/485.png" alt="" width="100%">
								</figure>
								<p class="px-3 pt-3 text-center">
									<small ><strong>Figure 6.</strong> Schematic diagram of 485 module connection.</small>
								</p>


							</div>


						</div>
						<!-- /aside -->
					</div>
					<!-- /row -->
				</div>
				<!-- /container -->
			</div>
			<!-- /section -->
		</main>


        <footer class="section bg-secondary mt-5 footer"></footer>

    </body>
</html>
